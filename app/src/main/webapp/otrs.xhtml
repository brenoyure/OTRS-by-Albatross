<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/_template.xhtml">

    <ui:define name="titulo">
        Serviço de Garantia
    </ui:define>


    <ui:define name="conteudo">


	    <h:form id="formulario-email-garantia" enctype="multipart/form-data">

	    <p:focus context="panel" />

	        <p:fieldset legend="Serviço de Garantia" collapsed="false" toggleable="true" > 
	                <p:panelGrid columns="3" id="panel" layout="tabular" >

	                    <p:outputLabel for="inputText-BM" value="BM: " />
	                        <p:inputText id="inputText-BM" value="#{otrsBean.bm}" maxlength="10" >
	                            <f:ajax event="change" execute="@this" render="inputText-NumeroDeSerie :mensagens" listener="#{otrsBean.buscarNumeroDeSeriePeloBm}" />
	                        </p:inputText>
	                        <p:commandButton value="Consultar" actionListener="#{otrsBean.buscarNumeroDeSeriePeloBm}" 
	                                            process="@this inputText-BM" update="inputText-NumeroDeSerie :mensagens" />

	                    <p:outputLabel for="inputText-NumeroDeSerie" value="Nº de Série: " />
	                        <p:inputText id="inputText-NumeroDeSerie" required="true" requiredMessage="Nº de Série Obrigatório" size="#{otrsBean.solicitacao.numeroDeSerie.length()}" value="#{otrsBean.solicitacao.numeroDeSerie}" >
	                            <f:ajax event="change" render="@this :mensagens" />
	                        </p:inputText>
	                    <br />

	                    <p:outputLabel for="selectOne-Ticket" value="Ticket: " /> <h:outputText value="Não há chamados abertos na Fila do Nível 1 com Serviço relacionado à Garantia, ex. Computador, Monitor... " rendered="#{empty otrsBean.serviceBean.ticketsAbertosNivel1}" />
	                        <p:selectOneMenu id="selectOne-Ticket" value="#{otrsBean.solicitacao.chamado}" required="true" requiredMessage="Ticket Obrigatório" converter="ticketConverter" rendered="#{not empty otrsBean.serviceBean.ticketsAbertosNivel1}" >
	                            <f:selectItem itemLabel="Selecione um Ticket" itemDisabled="false" noSelectionOption="true" />
	                            <f:selectItems value="#{otrsBean.serviceBean.ticketsAbertosNivel1}" var="ticket" itemLabel="Nº: #{ticket.numeroDoChamado} | Título: #{ticket.titulo} | Serviço: #{ticket.dadosDoServico.nomeDoServico} | Usuário: #{ticket.dadosDoUsuarioCliente.nomeDoUsuarioCliente}" itemValue="#{ticket}" />
	                            <f:ajax event="change" listener="#{otrsBean.definirAssuntoDoEmail}" render=":mensagens @this outputText-Assunto" />
	                        </p:selectOneMenu>
	                        <p:commandButton value="Selecionar" 
	                                         process="selectOne-Ticket" update=":mensagens selectOne-Ticket outputText-Assunto" disabled="#{empty otrsBean.serviceBean.ticketsAbertosNivel1}" />

	                    <p:outputLabel value="Problema: " for="selectOne-DescricaoProblema" />
	                    <p:outputLabel value="Nenhum Texto Pronto Cadastrado" rendered="#{empty otrsBean.serviceBean.listaDeProblemas}" /> <p:divider rendered="#{empty otrsBean.serviceBean.listaDeProblemas}" />
	                        <p:selectOneMenu id="selectOne-DescricaoProblema" value="#{otrsBean.solicitacao.descricaoDoProblema}" required="true" requiredMessage="Descrição do Problema Obrigatória" converter="descricaoProblemaConverter" rendered="#{not empty otrsBean.serviceBean.listaDeProblemas}" >
	                            <f:selectItem itemLabel="Selecione o Problema" itemDisabled="false" noSelectionOption="true" />
	                            <f:selectItems var="problema" value="#{otrsBean.serviceBean.listaDeProblemas}" itemLabel="#{problema.problema.tipo} - #{problema.descricaoResumida}" itemDescription="#{problema.descricaoDetalhada}" itemValue="#{problema}" />
	                            <f:ajax event="change" render=":mensagens @this textArea-DescricaoProblema" />
	                        </p:selectOneMenu>
	                        <p:commandButton value="Utilizar" rendered="#{not empty otrsBean.serviceBean.listaDeProblemas}"
	                            process="selectOne-DescricaoProblema" update=":mensagens selectOne-DescricaoProblema textArea-DescricaoProblema" />


	                    <p:outputLabel for="outputText-Assunto" value="Assunto: " />
	                        <h:outputText id="outputText-Assunto" value="#{otrsBean.solicitacao.emailDeGarantia.assunto}" size="#{otrsBean.solicitacao.emailDeGarantia.assunto.length()}" />
	                    <br />

	                    <p:outputLabel for="textArea-DescricaoProblema" value="Descrição do Problema" />
	                        <p:inputTextarea readonly="true" rows="6" cols="33" id="textArea-DescricaoProblema" placeholder="Computador/Monitor está apresentando problema de..." value="#{otrsBean.solicitacao.descricaoDoProblema.descricaoDetalhada}" autoResize="false" required="true" requiredMessage="Descrição do Problema Obrigatória" />
	                    <br />

	                    <p:outputLabel value="Adicionar Vídeo ou Foto do Problema (Máx: 10MB)" for="fileUpload" />
	                        <h:inputFile id="fileUpload" styleClass="form-control" value="#{otrsBean.uploadedFile}" required="false" >
	                            <f:ajax execute="@this" render=":mensagens" />
	                        </h:inputFile>

	                    <br />

	                </p:panelGrid>
	        </p:fieldset>

	        <p:fieldset legend="Dados do Envio" collapsed="false" toggleable="true" >
	            <p:panelGrid columns="1" layout="tabular" >
	                    <p:outputLabel for="inputText-EmailRemetente" value="E-mail do Remetente: ">
	                        <p:inputText id="inputText-EmailRemetente" placeholder="email.do.atendente@empresa.br" type="email" value="#{otrsBean.solicitacao.emailDeGarantia.dadosDoEnvio.remetente}" required="true" requiredMessage="E-mail do Remetente é Obrigatório." size="#{otrsBean.solicitacao.emailDeGarantia.dadosDoEnvio.remetente.length()}" >
	                            <f:ajax event="input" execute="@this" render="@this :mensagens" />
	                        </p:inputText>
	                    </p:outputLabel>

	                    <p:outputLabel for="inputText-EmailDestino" value="E-mail(s) de Destino(s): ">
	                        <p:inputText id="inputText-EmailDestino" placeholder="suporte.fabricante@empresa.br" type="email" value="#{otrsBean.solicitacao.emailDeGarantia.dadosDoEnvio.destinatario}" required="true" requiredMessage="E-mail de Destino Obrigatório." size="#{otrsBean.solicitacao.emailDeGarantia.dadosDoEnvio.destinatario.length()}" >
	                            <f:ajax event="input" execute="@this" render="@this :mensagens" />
	                        </p:inputText>
	                    </p:outputLabel>

	                    <p:outputLabel for="inputText-EmailCopia" value="(Opcional) Cópia para: ">
	                        <p:inputText id="inputText-EmailCopia" type="email" value="#{otrsBean.solicitacao.emailDeGarantia.dadosDoEnvio.copiaPara}" size="#{otrsBean.solicitacao.emailDeGarantia.dadosDoEnvio.copiaPara.length()/2}" >
	                            <f:ajax event="input" execute="@this" render="@this" />
	                        </p:inputText>
	                    </p:outputLabel>
	            </p:panelGrid>
	        </p:fieldset>

	            <p:commandButton type="submit" value="Enviar Solicitação" update=":mensagens @form" actionListener="#{otrsBean.enviarSolicitacaoDeGarantiaPorEmail}" style="margin-right: 5px; margin-top:10px" disabled="#{empty otrsBean.serviceBean.ticketsAbertosNivel1}" />
	            <p:commandButton value="Limpar Formulário" action="otrs?faces-redirect=true" immediate="true" update="@all" style="margin-top:10px" />

	        <br />

	    </h:form>


    </ui:define>

</ui:composition>

</html>
