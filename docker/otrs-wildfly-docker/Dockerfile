FROM quay.io/wildfly/wildfly:28.0.1.Final-jdk17

WORKDIR /opt/jboss/wildfly

ARG MYSQL_OTRS_CONTAINER_NAME=${MYSQL_OTRS_CONTAINER_NAME}
ARG MYSQL_OTRS_TEXTOS_PRONTOS_CONTAINER_NAME=${MYSQL_OTRS_TEXTOS_PRONTOS_CONTAINER_NAME}

ARG MYSQL_OTRS_DATABASE=${MYSQL_OTRS_DATABASE}
ARG MYSQL_OTRS_USER=${MYSQL_OTRS_USER}
ARG MYSQL_OTRS_PASSWORD=${MYSQL_OTRS_PASSWORD}
ARG MYSQL_OTRS_DATABASE_HOST=${MYSQL_OTRS_DATABASE_HOST}

ARG MYSQL_OTRS_TEXTOS_PRONTOS_DATABASE=${MYSQL_OTRS_TEXTOS_PRONTOS_DATABASE}
ARG MYSQL_OTRS_TEXTOS_PRONTOS_USER=${MYSQL_OTRS_TEXTOS_PRONTOS_USER}
ARG MYSQL_OTRS_TEXTOS_PRONTOS_PASSWORD=${MYSQL_OTRS_TEXTOS_PRONTOS_PASSWORD}
ARG MYSQL_OTRS_TEXTOS_PRONTOS_DATABASE_HOST=${MYSQL_OTRS_TEXTOS_PRONTOS_DATABASE_HOST}

ARG OTRS_MAIL_SESSION_USER=${OTRS_MAIL_SESSION_USER}
ARG OTRS_MAIL_SESSION_PASSWORD=${OTRS_MAIL_SESSION_PASSWORD}
ARG OTRS_MAIL_SMTP_HOST=${OTRS_MAIL_SMTP_HOST}
ARG OTRS_MAIL_SMTP_PORT=${OTRS_MAIL_SMTP_PORT}

ADD mysql-connector-j-8.0.33.jar ./modules/mysql/
COPY Formulario-Garantia.docx ./bin/arquivos/formularios/

ADD otrs.war ./standalone/deployments/

COPY config.cli ./bin/config.cli

RUN ["/opt/jboss/wildfly/bin/jboss-cli.sh", "--file=/opt/jboss/wildfly/bin/config.cli", "--resolve-parameter-values"]

CMD ["/opt/jboss/wildfly/bin/standalone.sh", "--server-config=standalone-full.xml", "-b", "0.0.0.0", "-bmanagement", "0.0.0.0"]

