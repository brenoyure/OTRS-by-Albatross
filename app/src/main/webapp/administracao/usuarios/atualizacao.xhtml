<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<ui:composition template="/_template.xhtml">
    <ui:define name="titulo">Atualização de Usuário</ui:define>
    <ui:define name="conteudo">

	    <f:metadata>
	        <f:viewParam  name="usuarioId" />
	        <f:viewAction action="#{atualizacaoUsuarioBean.carregarUsuarioPeloId(param.usuarioId)}" if="#{param.usuarioId != null}" />
	    </f:metadata>

	    <div style="width: 50vw; display: flex;">
	        <h:form id="form-cadastroUsuario">
	            <p:focus context="panel" />
	            <p:fieldset legend="Administração / Usuários / Atualização de Cadastro">

	                <p:panelGrid columns="2" id="panel" layout="tabular">

	                    <p:outputLabel for="inputText-username" value="Nome do Usuário: " />
	                    <p:outputLabel value="Administrador" rendered="#{atualizacaoUsuarioBean.dados.username == 'Administrador'}" />
	                    <p:inputText id="inputText-username"
	                        value="#{atualizacaoUsuarioBean.dados.username}" required="true"
	                        requiredMessage="Nome de Usuário é Obrigatório" maxlength="55" 
	                        rendered="#{atualizacaoUsuarioBean.dados.username != 'Administrador'}">
	                    </p:inputText>

	                    <p:outputLabel for="@next" value="Nova Senha: " />
	                    <p:password 
	                        id="inputText-password"
	                        value="#{atualizacaoUsuarioBean.dados.password}" 
	                        match="inputText-password-confirm"
	                        validatorMessage="Senhas não conferem, tente novamente"
	                        required="true" requiredMessage="Digite novamente a Senha para confirmar" 
	                        maxlength="100">
	                    </p:password>

	                    <p:outputLabel for="@next" value="Confirme a Senha: " />
	                    <p:password 
	                        id="inputText-password-confirm"
	                        value="#{atualizacaoUsuarioBean.dados.password}" 
	                        required="true" requiredMessage="Senha do Usuário é Obrigatório" 
	                        maxlength="100">
	                    </p:password>

	                    <p:outputLabel for="selectMany-usuarioRoles" value="Selecione a ou as permissões para o usuário: " rendered="#{atualizacaoUsuarioBean.dados.username != 'Administrador'}" />
	                    <p:outputLabel for="@next" style="color: red;" value="Para manter a integridade do sistema, não será possível alterar o nome ou permissões do usuário atual, visto que, é necessário pelo menos um usuário com privilégios administrativos." rendered="#{atualizacaoUsuarioBean.dados.username == 'Administrador'}" />
	                    <p:selectManyCheckbox id="selectMany-usuarioRoles" required="true" value="#{atualizacaoUsuarioBean.dados.rolesIds}" converter="jakarta.faces.Integer" requiredMessage="Usuário deve possuir pelo menos a Role: USER" disabled="#{atualizacaoUsuarioBean.dados.username == 'Administrador'}" >
	                        <f:selectItems value="#{listaRolesBean.roles}" var="role" itemLabel="#{role.name}" itemValue="#{role.id}" />
	                    </p:selectManyCheckbox>
	
	                </p:panelGrid>

	                <p:commandButton id="commandButton-atualizarUsuario" value="Atualizar"      actionListener="#{atualizacaoUsuarioBean.atualizarCadastro}" process="@form" update="@form :mensagens" rendered="#{atualizacaoUsuarioBean.dados.username != 'Administrador'}" />
	                <p:commandButton id="commandButton-alterarSenha"     value="Alterar Senha"  actionListener="#{atualizacaoUsuarioBean.atualizarCadastro}" process="@form" update="@form :mensagens" rendered="#{atualizacaoUsuarioBean.dados.username == 'Administrador'}" />

	            </p:fieldset>
	        </h:form>
	    </div>
    </ui:define>
</ui:composition>

</html>
